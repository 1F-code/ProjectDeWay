@model IEnumerable<Project.Models.Cart_OrderDetail>

@{
    ViewBag.Title = "我的購物車";
    int count = 0;


}

<h2 class="mb-3">@Html.DisplayFor(m => m.ToList()[0].Member.mbrName)的購物車</h2>



<div class="row">
    <div class="col-8">
        @foreach (var item in Model)
        {
            <div class="card mb-3" style="max-width: 700px;">
                <div class="card-header">
                    <div class="nav nav-pills card-header-pills">
                        <div class="w-25 form-inline">
                            <input type="checkbox"
                                   onclick="changeChckeStatus(checkStatus,@count)">
                            <div class="h4 ml-2">@Html.DisplayFor(model => item.Specification.Product.Seller.selCompany)</div>
                        </div>
                        <div class="w-75  text-right">
                            <a class="btn btn-outline-secondary " onclick=" return confirm('確定要刪除嗎?')" href="@Url.Action("Delete", "Cart", new { cartID = item.cartID, mbrID = item.mbrID })">X</a>
                        </div>
                    </div>
                </div>
                <div class="row no-gutters">
                    <div class="col-md-1"></div>
                    <div class="col-md-3 text-center my-auto">
                        <img src="~/Image/diamond-4229493_960_720.jpg"
                             class="card-img"
                             alt="NoImage">
                    </div>
                    <div class="col-md-4">
                        <div class="card-body">
                            <h3 class="card-title">@Html.DisplayFor(modelItem => item.Specification.Product.pdtName)</h3>
                            <p class="card-text">
                                商品樣式：
                                @Html.DisplayFor(modelItem => item.Specification.Size)
                                @Html.DisplayFor(modelItem => item.Specification.Style)
                            </p>
                            <p class="text-primary">NT$ <span id="price_@count">@Html.DisplayFor(modelItem => item.Specification.Price)</span></p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card-body">
                            <p class="text-primary">
                                選購數量：    <span id="count_@count">@Html.DisplayFor(modelItem => item.Quantity)</span>
                            </p>
                            <p class="text-secondary">
                                折扣：    @Html.DisplayFor(modelItem => item.Discount)<br />
                                點數使用：    @Html.DisplayFor(modelItem => item.usedPoints)<br />
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            count = count + 1;
        }
    </div>
    <div class="col-4">
        <div class="card sticky-top">
            <div class="card-header">
                訂單摘要
            </div>
            <div class="card">
                <p class="card-text">商品總計：<span id="priceTotal">NT$ 0</span></p>
                <p class="card-text">運費總計：<span id="shpTotal">NT$ 0</span></p>
                <hr />
                <a href="">使用優惠券、紅利或禮物卡</a>
            </div>
        </div>
    </div>
</div>
@section cartScript{
    <script>
        //var price = 0;
       var len = $("div[class='col-8']").children().length

        //for (var i = 0; i < len; i++) {
        //    price += parseInt($("#price_" + i).text());
        //    console.log(price);
        //


        var checkStatus = [];//利用陣列存取誰被點選
        for (var i = 0; i < len; i++) { //初始化陣列(沒有商品被點選)
            checkStatus.push(false);
        }
        //點選其中一個商品後，改變checkStatus
        function changeChckeStatus(arr, index) {
            arr[index] = !arr[index];
            console.log(arr);
            updateTotalPrice(arr);//點選後調用更新功能
        }



        //更新功能
        function updateTotalPrice(arr) {
            var price, count, totalPrice = 0;
            for (i = 0; i < arr.length; i++) {
                if (arr[i] == true) {
                    //獲取被點選商品的價格與數量
                    price = parseInt($("#price_" + i).text());
                    count = parseInt($("#count_" + i).text());
                    console.log(price)
                    console.log(count);
                    //相乘後計算總價
                    totalPrice += price * count;
                }
            }
            //在欄位顯示總價
            $("#priceTotal").text("NT$ "+totalPrice);
        }
    </script>
}

